{% extends 'uniconnect_app/base.html' %}
{% load i18n %}
{% load staticfiles %}
<<<<<<< HEAD
{% load i18n %}
=======
{% load humanize %}
{% load comments %}
>>>>>>> b9d2ced82828db506bc3f99f4d439f0d1de2e8a0
{% block content %}
{% load widget_tweaks %}
<div class="heading index-heading">{{post.subject|title}}</div>
<div class="heading float-left pv-author">By <i><a href="/profile/{{post.author.username}}">{{post.author.username}}</a></i></div>
    {% if tags %}
<div class="heading float-right pv-tags">Tags:
    {% for tag in tags %}
    <a href="/tag/{{tag.tag}}/">{{tag.tag}}</a>
    {% endfor %}
    {% endif %}
</div>
  <div class="post-content pv-content ">
  {{post.content}}<br><br><br>

    <img src="{{post.picture_link}}" width="140" height=auto>


  </div>
    <div class="post-date vp-date">Published on  {{ post.post_date }}

     <div class="follow-delete">
        <form class="formFollowEvent float-right">

            {% csrf_token %}
            <input type="hidden" value="{{ post.id }}" name="post_id">
            <button type="submit" class="btn-default btn-vp follow-button btn-sm">
                {% if user in post.followers.all %}
                {% trans "Unfollow" %}
                {% else %}
                {% trans "Follow" %}
                {% endif %}</button>
        </form>
        <script>
    $('.formFollowEvent').on('submit', function(e) {
    e.preventDefault();

    var $this = $(this);
    var button = $this.find('button[type="submit"]');
    var post_id = $this.find('input[name="post_id"]').val();

    $.ajax({
        url: "follow/",
        data: {
            post_id: post_id
        },
        success:function(data){
             button.text((data.following) ? "Unfollow" : "Follow");
        }
    })
});
</script></div>
        <a href="/post/{{post.id}}/edit" class="float-right vp-link">Edit Post</a>
        <script href="{% static 'board/follow.js' %}"></script>
        {% if user == post.author %}
        <a class="confirm-delete float-right vp-link" href="{% url 'delete-post' post.id %}">Delete Post</a>
        <script>
        $(document).on('click', '.confirm-delete', function(){
            return confirm('Are you sure you want to delete this post?');
        })
        </script>
    {% endif %}
     <div class="comments">
    <p class="heading">{{ comments|length }} comments have been posted. </p>
    {% for comment in comments %}
        <h4>{{ comment.author }} commented</h4>
        <p>{{ comment.comment_date }}</p>
        <p>{{ comment.text }}</p>
        {% if user == comment.author %}
            <a href="/comments/delete_own/{{comment.id}}">[X] Delete Comment</a></td>
        {% endif %}
    {% endfor %}
    </div>


    <!--<a href=  % url 'delete-post'%}>delete</a> -->
<!-- A context variable called form is created with the necessary hidden
fields, timestamps and security hashes -->

    {% if user.is_authenticated %}
    <div class="box comments-box">
    <form action="comments/add/" method="POST">
    {% csrf_token %}
    {{ form }}
    <input type="submit" value="Add comment" id="id_submit" />
    </form>
</div>
{% else %}
    <p class="heading pv-login">Please <a href="/login/">log in</a> to leave a comment.</p>
{% endif %}
{% endblock %}