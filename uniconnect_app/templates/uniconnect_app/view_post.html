{% extends 'uniconnect_app/base.html' %}
{% load staticfiles %}
{% load comments %}
{% load i18n %}
{% block content %}

<div class="container" style="width:40%">
    <h3>{{post.subject|title}}</h3>
    {% if user == post.author %}
    <a href="/post/{{post.id}}/edit">edit</a>
    {% endif %}
    <h4>By <i>{{post.author.username}} </i></h4>
    <img src="{{post.picture_link}}" width="140" height=auto></a>
    {% if tags %}
    <h4>Tags: 
        {% for tag in tags %}
        <a href="/tag/{{tag.tag}}/">{{tag.tag}}</a>
        </i>
        {% endfor %}
        {% endif %}
    </h4>
        <p><i>Published on </i> {{ post.post_date }} </p>
    <p> {{post.content}} </p>

<!--
<form class="formFollowEvent">
    {#% csrf_token %#}
    <input type="hidden" value="{ post.id }}" name="post_id">
    <button type="submit" class="btn btn-warning btn-block">
        % if user in post.followers.all %}
            % trans "Unfollow" %}
         {#% else %#}
            % trans "Follow" %}
        {#% endif %#}</button>
</form>
<script>
    $('.formFollowEvent').on('submit', function(e) {
    e.preventDefault();

    var $this = $(this);
    var $button = $this.find('button[type="submit"]');
    var post_id = $this.find('input[name="post_id"]').val();

    $.ajax({
        url:'post/'+post_id +'/follow/',
        data: {
            post_id: post_id
        },
        success:function(data){
             $button.text((!data.following) ? {#% trans "Unfollow"%#} : {#% trans "Follow"%#});
        }
    })
});
</script>
-->
    {% if user == post.author %}
        <a class="confirm-delete" href="{% url 'delete-post' post.id %}">Delete</a>
        <script>
        $(document).on('click', '.confirm-delete', function(){
            return confirm('Are you sure you want to delete this post?');
        })
        </script>
    {% endif %}
    {% get_comment_count for post as comment_count %}
    <p>{{ comment_count }} comments have been posted.</p>
    {% render_comment_list for post %}

</div>
    <!--<a href=  % url 'delete-post'%}>delete</a> -->
<!-- A context variable called form is created with the necessary hidden
fields, timestamps and security hashes -->
    {% if user.is_authenticated %}
    {% get_comment_form for post as form %}
    <form action="{% comment_form_target %}" method="POST">
    {% csrf_token %}
    {{ form.comment }}
    {{ form.content_type }}
    {{ form.object_pk }}
    {{ form.timestamp }}
    {{ form.security_hash }}
    <input type="hidden" name="next" value={% url 'show-post' post.id  %}>
    <input type="submit" value="Add comment" id="id_submit" />


    </form>
{% else %}
    <p>Please <a href="{% url 'login' %}">log in</a> to leave a comment.</p>
{% endif %}


{% endblock %}
